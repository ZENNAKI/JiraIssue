JIRA.VersionBlocks={};JIRA.VersionBlocks.ClassNames={VERSION_LIST:"versions-list",VERSION_CONTAINER:"version-block-container",EXPANDED_CONTENT_CONTAINER:"version-issue-table"};JIRA.VersionBlocks.init=(function(){var classNames=JIRA.VersionBlocks.ClassNames;var dataElement=AJS.$("."+classNames.VERSION_LIST).first();var urlEndpoint=getUrl();AJS.$(document).on("click","a[data-version-block]",function(e){var $a=AJS.$(this),$root=$a.closest("."+classNames.VERSION_CONTAINER);var isActive=$root.data("expanded");var $container=$root.find("."+classNames.EXPANDED_CONTENT_CONTAINER);var $spinner=AJS.$("<span class='icon loading'></span>");if(!$container.size()){$container=AJS.$("<div/>").addClass(classNames.EXPANDED_CONTENT_CONTAINER).hide().appendTo($root)}var extraParams={};extraParams[(isActive)?"collapseVersion":"expandVersion"]=$root.find("[data-version-id]").data("version-id");var request=AJS.$.ajax({url:urlEndpoint,data:getUrlParams(extraParams),dataType:"json",beforeSend:function(){$a.closest("ul").append(AJS.$("<li/>").append($spinner))}});request.always(function(){$spinner.parent("li").remove()});request.fail(function(jqXHR,textStatus,errorThrown){console.log("Failed to load issues for version. User-facing error to do, sorry :(",arguments)});if(!isActive){request.done(function(data,textStatus,jqXHR){var html=AJS.$("<div/>").html(data.content);var content=html.find("."+classNames.EXPANDED_CONTENT_CONTAINER);$container.hide().replaceWith(content).show()})}else{request.done(function(){$container.hide()})}request.done(function(){$root.data("expanded",!isActive)});e.preventDefault()});function getUrl(){var href;href=document.location.href;href=href.replace(document.location.hash,"");href=href.replace(document.location.search,"");return href}function getUrlParams(opts){var params={decorator:"none",contentOnly:true,noTitle:true,selectedTab:getSelectedTab(),pid:dataElement.data("project-id"),component:dataElement.data("component-id")};return jQuery.extend(params,opts)}function getSelectedTab(){var selectedTab=dataElement.data("selected-tab");var paramString=""+document.location.search+document.location.hash;if(paramString.indexOf("selectedTab=")>-1){selectedTab=paramString.replace(/^.*selectedTab=(.*?)(?:&.*$|$)/,"$1");selectedTab=decodeURIComponent(selectedTab)}return selectedTab}});