define("jira/common/header",["jira/message","jira/issue","jira/util/events","jquery","exports"],function(Messages,Issue,Events,jQuery,exports){var messageBuffer={};var getProjectAdminLink=function(issueKey,section){var projectKey=issueKey.substr(0,issueKey.indexOf("-"));return AJS.format('<a href="{0}" target="_blank">',AJS.contextPath()+"/plugins/servlet/project-config/"+projectKey+"/"+section)};var showMessage=function(html){if(html){Messages.showSuccessMsg(html,{closeable:true})}messageBuffer={}};var getEditMessage=function(versionMsg,compnentMsg){var html="";if(messageBuffer.versionCreated){html="<p>"+versionMsg+"</p>"}if(messageBuffer.componentCreated){html+="<p>"+compnentMsg+"</p>"}return html};var issueApp=function getKickAssAPIObject(){if(JIRA&&JIRA.Issues&&JIRA.Issues.Application){return JIRA.Issues.Application}return false};var sessionCompleteCb,saveSuccessCb,versionCb,componentCb;exports.initialize=function(){Events.bind("QuickCreateIssue.sessionComplete",sessionCompleteCb=function(e,issues){var issue=[].concat(issues).pop();var html=Issue.issueCreatedMessage(issue);html+=getEditMessage(AJS.I18n.getText("jira.version.created.quick.create",getProjectAdminLink(issue.issueKey,"versions"),"</a>"),AJS.I18n.getText("jira.component.created.quick.create",getProjectAdminLink(issue.issueKey,"components"),"</a>"));showMessage(html)});if(issueApp()){issueApp().on("issueEditor:saveSuccess",saveSuccessCb=function(saveDetails){var issueKey=saveDetails&&saveDetails.issueKey?saveDetails.issueKey:Issue.getIssueKey();var msg=getEditMessage(AJS.I18n.getText("jira.version.created",getProjectAdminLink(issueKey,"versions"),"</a>"),AJS.I18n.getText("jira.component.created",getProjectAdminLink(issueKey,"components"),"</a>"));showMessage(msg)})}Events.bind("Issue.Version.new.selected",versionCb=function(){messageBuffer.versionCreated=true});Events.bind("Issue.Component.new.selected",componentCb=function(){messageBuffer.componentCreated=true})};exports.unbind=function(){Events.unbind("QuickCreateIssue.sessionComplete",sessionCompleteCb);Events.unbind("Issue.Version.new.selected",versionCb);Events.unbind("Issue.Component.new.selected",componentCb);if(issueApp()){issueApp().unbind("issueEditor:saveSuccess",saveSuccessCb)}}});