define("jira/field/assignee-picker",["jira/ajs/select/scrollable-single-select","jira/ajs/select/suggestions/assignee-suggest-handler","jira/ajs/list/group-descriptor","jira/ajs/list/item-descriptor","aui/params","jquery"],function(ScrollableSingleSelect,AssigneeSuggestHandler,GroupDescriptor,ItemDescriptor,params,$){return ScrollableSingleSelect.extend({init:function(options){var element=(options.element instanceof $)?options.element:$(options.element);function data(query){params.actionDescriptorId=undefined;AJS.populateParameters();return{username:query,projectKeys:params.projectKeys,issueKey:params.assigneeEditIssueKey,actionDescriptorId:params.actionDescriptorId,maxResults:500}}function formatResponse(response){var ret=[];if(response.length){var groupDescriptor=new GroupDescriptor({weight:1,id:"assignee-group-search",uniqueItemScope:"container",replace:true,label:AJS.I18n.getText("assignee.picker.group.search")});for(var i=0,len=response.length;i<len;i++){var user=response[i];var username=user.name;var displayName=user.displayName;var emailAddress=user.emailAddress;var label=displayName;if(emailAddress){label+=" - "+emailAddress}label+=" ("+username+")";groupDescriptor.addItem(new ItemDescriptor({value:username,fieldText:displayName,label:label,allowDuplicate:false,icon:user.avatarUrls["16x16"]}))}ret.push(groupDescriptor)}return ret}$.extend(options,{submitInputVal:true,showDropdownButton:!!element.data("show-dropdown-button"),errorMessage:AJS.I18n.getText("assignee.picker.invalid.user"),localDataGroupId:"assignee-group-suggested",content:"mixed",removeDuplicates:true,ajaxOptions:{url:function(){params.assigneeEditIssueKey=undefined;AJS.populateParameters();var path=params.assigneeEditIssueKey?"search":"multiProjectSearch";return contextPath+"/rest/api/latest/user/assignable/"+path},query:true,data:data,formatResponse:formatResponse}});if(options.editValue=="-1"){options.editValue=false;element.val("-1")}this._super(options);this.suggestionsHandler=new AssigneeSuggestHandler(this.options,this.model)},handleFreeInput:function(value){if(""===$.trim(value||this.$field.val())){this.setSelection(this.model.getDescriptor("-1"))}else{this._super(value)}},cleanUpModel:function(){}})});AJS.namespace("JIRA.AssigneePicker",null,require("jira/field/assignee-picker"));