(function(jQuery){var PARAMS=[{selector:"#issue-type-scheme-name",name:"schemeName"},{selector:"#issue-type-scheme-description",name:"schemeDescription"},{selector:"input[name='fieldId']",name:"fieldId"},{selector:"input[name='schemeId']",name:"schemeId"},{selector:"input[name='projectId']",name:"projectId"},{selector:"#default-issue-type-select",name:"defaultOption"}];var isEditMode=undefined;var getSelectedOptions=function(){var s=jQuery("#selectedOptions").sortable("serialize",{key:"selectedOptions"});if(s===""){return"selectedOptions="}else{return s}};var submitForm=function(eButton){eButton.form.action="ConfigureOptionSchemes.jspa?"+getSelectedOptions();return true};var updateAddIssueTypeUrl=function(){var s="AddNewIssueTypeToScheme!input.jspa?"+getSelectedOptions();var values={};for(var i=0;i<PARAMS.length;i++){var $el=jQuery(PARAMS[i].selector);values[PARAMS[i].name]=$el.val()}s=s+"&"+jQuery.param(values);jQuery("#add-new-issue-type-to-scheme").attr("href",s)};var restrictOptions=function(){var queryString=getSelectedOptions().replace(/selectedOptions=/g,"");var selectedOptions=queryString.split("&");var sel2=document.getElementById("default-issue-type-select");for(var i=0;i<sel2.options.length;i++){if(sel2.options[i].value===""||arrayContains(selectedOptions,sel2.options[i].value)){jQuery(sel2.options[i]).css({display:"",color:"#000",textDecoration:"none"}).removeAttr("disabled")}else{if(sel2.options[i].selected){sel2.options[i].selected=false;sel2.options[0].selected=true}jQuery(sel2.options[i]).css({display:"none",color:"#ffcccc",textDecoration:"line-through"}).attr("disabled","disabled")}}updateAddIssueTypeUrl()};var moveAll=function(fromList,toList){jQuery("#"+fromList).find("li").appendTo(document.getElementById(toList));restrictOptions()};var sendAnalyticsEvent=function(name){if(_.isUndefined(isEditMode)){isEditMode=AJS.$("input[name=schemeId]").val();if(!isEditMode){isEditMode=false}}if(AJS.EventQueue&&isEditMode){AJS.EventQueue.push({name:"administration.issuetypeschemes.issuetype."+name+".global"})}};AJS.namespace("JIRA.Issue.editIssueTypeScheme",null,function(){jQuery("#selectedOptionsRemoveAll").click(function(e){moveAll("selectedOptions","availableOptions");e.preventDefault()});jQuery("#selectedOptionsAddAll").click(function(e){moveAll("availableOptions","selectedOptions");e.preventDefault()});jQuery("#selectedOptions").sortable({update:restrictOptions,opacity:0.7,connectWith:[document.getElementById("availableOptions")],update:function(event,ui){if(!ui.sender&&ui.item.parent()[0].id!=="availableOptions"){sendAnalyticsEvent("reordered")}},receive:function(event,ui){sendAnalyticsEvent("added")},remove:function(event,ui){sendAnalyticsEvent("removed")}});if(AJS.params.allowEditOptions){jQuery("#availableOptions").sortable({update:restrictOptions,opacity:0.7,connectWith:[document.getElementById("selectedOptions")]})}jQuery("#submitSave").click(function(){submitForm(this)});jQuery("#submitReset").click(function(e){if(AJS.params.resetUrl){jQuery(this).removeDirtyWarning();window.location=AJS.params.resetUrl}e.preventDefault()});jQuery("#issue-type-scheme-name, #issue-type-scheme-description, #default-issue-type-select").change(updateAddIssueTypeUrl);new JIRA.FormDialog({trigger:"#add-new-issue-type-to-scheme",id:"add-new-issue-type-to-scheme-dialog",ajaxOptions:{data:{decorator:"dialog",inline:"true"}},onSuccessfulSubmit:function(data){var $template=jQuery("<div>").html(data).find("#add-issue-type-template");$template.find("li").appendTo("#selectedOptions");var $newSelect=$template.find("select");if($newSelect.length>0){jQuery("#default-issue-type-select").unbind().replaceWith($newSelect);$newSelect.attr("id","default-issue-type-select").change(updateAddIssueTypeUrl)}restrictOptions();if(AJS.EventQueue){AJS.EventQueue.push({name:"administration.issuetypeschemes.issuetype.created.global"})}},onDialogFinished:function(){this.hide()}});restrictOptions()});jQuery(JIRA.Issue.editIssueTypeScheme)})(AJS.$);AJS.namespace("jira.app.editIssueTypeScheme",null,JIRA.Issue.editIssueTypeScheme);