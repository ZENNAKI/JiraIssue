AJS.$(function(){function getView(collection){if(collection.isReadOnly){return JIRA.WatchersReadOnly}else{if(collection.canBrowseUsers){return JIRA.WatchersView}else{return JIRA.WatchersNoBrowseView}}}require(["aui/inline-dialog2"]);AJS.$(document).on("click","#view-watcher-list",function(e){e.preventDefault();var dialog=AJS.$("#inline-dialog-watchers");var loadingIcon=AJS.$("#watching-toggle").next(".icon");var collection=new JIRA.WatchersUsersCollection(JIRA.Issue.getIssueKey());loadingIcon.addClass("loading");var ViewClass=getView(collection);new ViewClass({collection:collection}).render().done(function(viewHtml){viewHtml.find(".cancel").click(function(closeEvent){dialog[0].hide();closeEvent.preventDefault()});loadingIcon.removeClass("loading");dialog.find(".aui-inline-dialog-contents").html(viewHtml);dialog[0].show()});collection.on("errorOccurred",function(){dialog[0].hide()})});AJS.$(document).bind("keydown",function(e){var dialog=AJS.$("#inline-dialog-watchers");if(e.keyCode===27&&AJS.InlineDialog.current!=dialog&&dialog.is(":visible")){if(AJS.InlineDialog.current){AJS.InlineDialog.current.hide()}dialog[0].hide()}});AJS.$(document).click(function(e){var dialog=AJS.$("#inline-dialog-watchers");var watchersDialogOrSuggestionClicked=AJS.$(e.target).closest("#inline-dialog-watchers, #watchers-suggestions").length;if(dialog[0]&&dialog[0].isVisible()&&watchersDialogOrSuggestionClicked===0){dialog[0].hide()}});JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason===JIRA.CONTENT_ADDED_REASON.panelRefreshed&&context.is("#peoplemodule")){var movedDialog=AJS.$(document.body).children("#inline-dialog-watchers");if(movedDialog.length!==0){movedDialog.remove()}}else{var dialog=AJS.$("#inline-dialog-watchers");dialog.attr("data-aui-persistent",true)}})});